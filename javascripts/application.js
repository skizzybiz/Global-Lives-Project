
if(window.Prototype===undefined){var Prototype={}}if(window.$===undefined){var $=function(){}}if(window.$$===undefined){var $$=function(){}}if(window.$H===undefined){var $H=function(){}}if(window.$A===undefined){var $A=function(){}}if(window.$F===undefined){var $F=function(){}}if(window.$R===undefined){var $R=function(){}}if(window.Class===undefined){var Class={}}if(window.Form===undefined){var Form={}}if(window.Effect===undefined){var Effect={}}if(window.Draggable===undefined){var Draggable={}}if(window.Droppables===undefined){var Droppables={}}if(window.Sortable===undefined){var Sortable={}}if(window.Control===undefined){var Control={}}if(window.Position===undefined){var Position={}}if(window.PeriodicalExecuter===undefined){var PeriodicalExecuter={}}var GLP={};GLP.Video=Class.create({initialize:function(A){console.log("GLP.Video initialize()");if(!A){console.log("GLP.Video: no container given");throw"ContainerNotGiven"}this.container=A;if(typeof (this.container.GLP)==="undefined"){this.container.GLP={}}this.container.GLP.Video=this;Object.extend(this,GLP.Video.HTML5);this.setup()},setup:function(){throw"MethodNotImplemented"},play:function(){throw"MethodNotImplemented"},pause:function(){throw"MethodNotImplemented"},togglePlay:function(){throw"MethodNotImplemented"},seek:function(A){throw"MethodNotImplemented"},setPlaybackRate:function(A){throw"MethodNotImplemented"},timecode:function(){throw"MethodNotImplemented"}});GLP.Videos=[];document.observe("dom:loaded",function(){$$(".GLP.Video").each(function(A){GLP.Videos.push(new GLP.Video(A))})});GLP.Video.HTML5={setup:function(){this.metadata_uri=this.container.getAttribute("data-html5");console.log(this.metadata_uri);new Ajax.Request(this.metadata_uri,{method:"get",evalJSON:"force",onSuccess:this.metadataRequestSuccess.bind(this),onFailure:this.metadataRequestFailure.bind(this)})},metadataRequestSuccess:function(A){this.metadata=A.responseJSON;var B=0;this.metadata.segments.each(function(C){C.start=B;C.end=B+C.duration;B+=C.duration});this.container.fire("video:metadataloaded");this.video=new Element("video",{src:this.metadata.segments[0].uri});this.container.insert(this.video)},metadataRequestFailure:function(A){window.alert("Failed to load video: "+A.responseText)},play:function(){this.video.play()},pause:function(){this.video.pause()},togglePlay:function(){if(this.video.paused){this.video.play();return"playing"}else{this.video.pause();return"paused"}},seek:function(A){if(typeof (A.hours)==="undefined"){A.hours=0}if(typeof (A.minutes)==="undefined"){A.minutes=0}if(typeof (A.seconds)==="undefined"){A.seconds=0}if(typeof (A.milliseconds)==="undefined"){A.milliseconds=0}var B=A.hours*3600+A.minutes*60+A.seconds+A.milliseconds;this.video.currentTime=B%this.video.duration},setPlaybackRate:function(A){this.video.playbackRate=A},timecode:function(){var B=this.video.currentTime;var A={hours:0,minutes:0,seconds:0,milliseconds:0,decimal:B};A.seconds=Math.floor(B);A.milliseconds=B-A.seconds;if(A.seconds>59){A.minutes=Math.floor(A.seconds/60);A.seconds=A.seconds-A.minutes*60;if(A.minutes>59){A.hours=Math.floor(A.minutes/60);A.minutes=A.minutes-A.hours*60}}return A}};GLP.TimelineControl=Class.create({initialize:function(A){console.log("GLP.TimelineControl initialize");this.container=A;if(!A){console.log("GLP.TimelineControl: no container given");throw ("ContainerNotGiven")}this.assign("clockFace",".clock-face");this.assign("handle",".handle",this.clockFace);this.assign("progress",".progress",this.clockFace);this.assign("digitalTime",".digital-time");this.assign("controls",".controls");this.assign("playpause",".playpause",this.controls);this.handleGrabbed=false;this.handle.observe("mousedown",this.handleGrab.bind(this));document.observe("mousemove",this.handleDrag.bind(this));document.observe("mouseup",this.handleRelease.bind(this));this.playpause.observe("click",this.pressPlayPause.bind(this));this.timecodeObserver=this.checkTimecode.bind(this);this.waitForVideoMetadata()},assign:function(C,A,B){if(typeof (A)==="undefined"){A=C}if(typeof (B)==="undefined"){B=this.container}this[C]=B.select(A).first();if(!this[C]){console.log("GLP.TimelineControl: unable to find '"+A+"'");throw ("SelectorNotFound")}return this[C]},waitForVideoMetadata:function(){this.totalDuration=0;GLP.Videos.each(this.updateTotalDurationFromVideo.bind(this));document.observe("video:metadataloaded",this.videoMetadataLoaded.bind(this))},videoMetadataLoaded:function(A){this.updateTotalDurationFromVideo(A.element().GLP.Video)},updateTotalDurationFromVideo:function(A){if(A.metadata&&A.metadata.totalDuration>this.totalDuration){this.totalDuration=A.metadata.totalDuration;console.log("updating total duration to "+this.totalDuration)}},handleGrab:function(A){console.log("STARTING DRAG");A.stop();this.handleGrabbed=true;var C=this.clockFace.viewportOffset();var B=this.clockFace.getDimensions();this.clockCenter={x:(C.left+(B.width/2)),y:(C.top+(B.height/2))}},handleDrag:function(B){if(!this.handleGrabbed){return }var A={x:(B.clientX-this.clockCenter.x),y:(B.clientY-this.clockCenter.y)};var C=Math.atan2(A.x,A.y)*180/Math.PI;C=180-C;this.updateFromAngle(C)},handleRelease:function(A){if(this.handleGrabbed){this.handleDrag(A);this.handleGrabbed=false;this.update()}},updateFromAngle:function(E){this.angle=E;this.elapsed=E/360;this.currentTime={};var D=this.currentTime.decimal=this.elapsed*this.totalDuration;var C=this.currentTime.hours=Math.floor(D/3600);var A=this.currentTime.minutes=Math.floor(D/60-C*60);var B=this.currentTime.seconds=Math.floor(D-A*60-C*3600);this.update()},update:function(A){if(typeof (A)==="undefined"){A={}}if(typeof (A.video)==="undefined"){A.video=true}if(typeof (A.digitalTime)==="undefined"){A.digitalTime=true}this.handle.setStyle({"-webkit-transform":"rotate("+this.angle+"deg)"});this.handle.style.setProperty("-moz-transform","rotate("+this.angle+"deg)","");this.changeProgress();if(A.digitalTime){this.changeDigitalTime()}if(!this.handleGrabbed&&A.video){GLP.Videos.each(function(B){B.seek(this.currentTime)}.bind(this))}},changeProgress:function(){this.progress.innerHTML="";var A;if(this.angle<0||this.angle>360){return }if(this.angle<=90){this.insertProgressWedge(this.angle-90);this.insertProgressWedge(270,{mask:true})}else{if(this.angle<=180){this.insertProgressWedge(0);this.insertProgressWedge(this.angle-90)}else{if(this.angle<=270){this.insertProgressWedge(0);this.insertProgressWedge(90);this.insertProgressWedge(this.angle-90)}else{this.insertProgressWedge(0);this.insertProgressWedge(90);this.insertProgressWedge(180);this.insertProgressWedge(this.angle-90)}}}},insertProgressWedge:function(D,A){if(!A){A={}}var C="images/clock-progress-arc.png";if(A.mask){C="images/clock-progress-arc-mask.png"}var B=new Element("img",{src:C,style:"-webkit-transform: rotate("+D+"deg); -moz-transform: rotate("+D+"deg)"});this.progress.insert(B)},changeDigitalTime:function(){this.digitalTime.innerHTML=this.currentTime.hours.toPaddedString(2)+":"+this.currentTime.minutes.toPaddedString(2)+":"+this.currentTime.seconds.toPaddedString(2)},pressPlayPause:function(A){A.stop();GLP.Videos.each(function(B){if(B.togglePlay()==="playing"){this.playing=true;this.playpause.select("img").first().src="images/pause.png";this.observeVideoProgress()}else{this.playpause.select("img").first().src="images/play.png";this.playing=false}}.bind(this))},checkTimecode:function(){if(!this.handleGrabbed){var A=this.currentTime=GLP.Videos.first().timecode();this.elapsed=A.decimal/this.totalDuration;this.angle=this.elapsed*360;this.update({video:false})}if(this.playing){window.setTimeout(this.timecodeObserver,200)}},observeVideoProgress:function(){window.setTimeout(this.timecodeObserver,200)}});GLP.TimelineControls=[];document.observe("dom:loaded",function(A){$$(".GLP.TimelineControl").each(function(B){GLP.TimelineControls.push(new GLP.TimelineControl(B))})});GLP.videos={};GLP.videosArray=[];function onYouTubePlayerReady(B){GLP.videos[B].handleYouTubePlayerReady();var A=document.getElementById(B);console.log(A);A.playVideo();A.addEventListener("onStateChange","ytStateChange1")}function onYouTubeStateChange0(A){GLP.videosArray[0].handleYouTubeStateChange(A)};